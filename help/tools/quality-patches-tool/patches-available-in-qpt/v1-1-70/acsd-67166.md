---
title: 'ACSD-67166: Duplicar la ejecución de la consulta "cataloginventory_stock_status" al cargar una cotización en la tienda'
description: Aplique el parche ACSD-67166 para corregir el problema de Adobe Commerce en el que la ejecución duplicada de la consulta cataloginventory_stock_status se produce al cargar una oferta en la tienda, lo que provoca llamadas de BD redundantes.
feature: Inventory
role: Admin, Developer
type: Troubleshooting
source-git-commit: ef596770b58528f9dddb4bd1650d7cbed0bf0b95
workflow-type: tm+mt
source-wordcount: '344'
ht-degree: 0%

---


# ACSD-67166: Duplicar la ejecución de la consulta `cataloginventory_stock_status` al cargar un presupuesto en la tienda

La revisión ACSD-67166 corrige el problema en el que la ejecución duplicada de la consulta `cataloginventory_stock_status` se produce al cargar una cotización en la tienda, lo que provoca llamadas de BD redundantes. Esta revisión está disponible cuando está instalado [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.70. El ID del parche es ACSD-67166. Este problema está programado para solucionarse en Adobe Commerce 2.4.9.

## Productos y versiones afectados

**El parche se ha creado para la versión de Adobe Commerce:**

* Adobe Commerce (todos los métodos de implementación) 2.4.5-p13

**Compatible con versiones de Adobe Commerce:**

* Adobe Commerce (todos los métodos de implementación) 2.4.4 - 2.4.8-p2

>[!NOTE]
>
>El parche podría ser aplicable a otras versiones con las nuevas versiones de [!DNL Quality Patches Tool]. Para comprobar si el parche es compatible con su versión de Adobe Commerce, actualice el paquete `magento/quality-patches` a la última versión y compruebe la compatibilidad en la página [[!DNL Quality Patches Tool]: buscar parches ](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html?lang=es). Utilice el ID de parche como palabra clave de búsqueda para localizar el parche.

## Problema

La ejecución duplicada de la consulta `cataloginventory_stock_status` se produce al cargar un presupuesto en la tienda, lo que provoca llamadas de BD redundantes.

<u>Pasos a seguir</u>:

1. Instale una instancia limpia.
1. Crear un **[!UICONTROL Category]** y un **[!UICONTROL Simple Product]**.
1. Vaya a la categoría y añada un producto al carro de compras.
1. Ir a la página del carro: `/checkout/cart/`
1. Establecer puntos de interrupción en [!DNL xDebug]:
   1. `app/code/Magento/CatalogInventory/Model/StockRegistryPreloader.php:115`
   1. `app/code/Magento/InventoryCatalog/Model/LegacyStockStatusCache.php:73`
   1. `lib/internal/Magento/Framework/Data/AbstractSearchResult.php:233`
   1. **Condición de punto de interrupción**: `strpos($this->query->getSelectSql(true), 'stock_status') !==false`
Agregue `$_SERVER['REQUEST_URI']` a *relojes* en [!DNL PHPStorm] para verificar que se llame dos veces a la consulta dentro de la misma solicitud.

<u>Resultados esperados</u>:

La consulta se ejecuta una vez por solicitud.

<u>Resultados reales</u>:

La misma consulta se ejecuta dos veces:

```
SELECT `main_table`.*, `cp_table`.`sku`, `cp_table`.`type_id` FROM `cataloginventory_stock_status` AS `main_table`
 INNER JOIN `catalog_product_entity` AS `cp_table` ON main_table.product_id = cp_table.entity_id AND (cp_table.created_in <= 1 AND cp_table.updated_in > 1) WHERE (`main_table`.`product_id` IN(2)) AND (`main_table`.`website_id` = '0') 
```

## Aplicar el parche

Para aplicar parches individuales, utilice los siguientes vínculos según el método de implementación:

* Adobe Commerce o Magento Open Source local: [[!DNL Quality Patches Tool] > Uso](/help/tools/quality-patches-tool/usage.md) en la guía [!DNL Quality Patches Tool]
* Adobe Commerce en la infraestructura de la nube: [Actualizaciones y parches > Aplicar parches](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html?lang=es) en la guía Commerce en la infraestructura de la nube

## Lectura relacionada

Para obtener más información sobre [!DNL Quality Patches Tool], consulte:

* [[!DNL Quality Patches Tool]: herramienta de autoservicio para parches de calidad](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) en la guía Herramientas
